<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Generator Nota Pembelian - Kunkun Moe (Updated)</title>
    <meta name="description" content="Generator Nota Pembelian Akun Premium Digital - Kunkun Moe Convert UI" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        :root{
            --accent1: #6366f1;
            --accent2: #8b5cf6;
            --muted: #64748b;
            --card-bg: rgba(255,255,255,0.96);
            --dark-card-bg: rgba(17,24,39,0.92);
        }

        html,body{
            height:100%;
            font-family: 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
            background: linear-gradient(135deg,#f8fafc 0%, #e2e8f0 100%);
            color: #0f172a;
            margin:0;
            -webkit-font-smoothing:antialiased;
            -moz-osx-font-smoothing:grayscale;
            font-size:14px; /* slightly smaller base font */
        }

        .dark-mode html, .dark-mode body {
            background: linear-gradient(135deg,#0f172a 0%, #1e293b 100%);
            color: #f1f5f9;
        }

        .container{
            max-width:980px;
            margin:28px auto;
            padding:16px;
        }

        .topbar{
            display:flex;
            justify-content:space-between;
            align-items:center;
            gap:12px;
            margin-bottom:12px;
        }

        .title {
            font-size:20px; /* smaller title */
            font-weight:700;
            background: linear-gradient(135deg,var(--accent1),var(--accent2));
            -webkit-background-clip:text;
            -webkit-text-fill-color:transparent;
        }
        .subtitle { color:var(--muted); font-size:13px; margin-top:2px; }

        .grid {
            display:grid;
            grid-template-columns:1fr 1fr;
            gap:14px;
        }
        @media (max-width:880px){ .grid{ grid-template-columns: 1fr; } }

        .card {
            background: var(--card-bg);
            border-radius:14px;
            padding:16px;
            border:1px solid rgba(0,0,0,0.04);
            box-shadow: 0 6px 18px rgba(15,23,42,0.06);
            transition: transform .18s ease, box-shadow .18s ease;
        }
        .card:hover{ transform: translateY(-4px); box-shadow: 0 12px 36px rgba(15,23,42,0.09); }
        .dark-mode .card{
            background: var(--dark-card-bg);
            border:1px solid rgba(139,92,246,0.06);
            box-shadow: 0 8px 26px rgba(0,0,0,0.5);
        }

        label{ font-weight:600; font-size:13px; color:var(--muted); display:block; margin-bottom:6px; }
        select,input,textarea{
            width:100%;
            padding:10px 12px;
            border-radius:10px;
            border:1px solid rgba(15,23,42,0.06);
            font-size:13px;
            color: inherit;
            background: rgba(255,255,255,0.94);
            transition: box-shadow .14s, transform .14s;
        }
        .dark-mode select,.dark-mode input,.dark-mode textarea{
            background: rgba(255,255,255,0.02);
            border:1px solid rgba(139,92,246,0.06);
        }
        select:focus,input:focus,textarea:focus{
            outline:none;
            box-shadow: 0 6px 20px rgba(99,102,241,0.08);
            transform: translateY(-2px);
            border-color: var(--accent1);
        }
        .hint { font-size:12px; color:var(--muted); margin-top:6px; }

        .field-row { display:grid; grid-template-columns: repeat(2,1fr); gap:10px; }
        @media (max-width:640px){ .field-row{ grid-template-columns:1fr; } }

        .btn {
            padding:10px 14px;
            border-radius:10px;
            font-weight:700;
            font-size:13px;
            cursor:pointer;
            display:inline-flex;
            align-items:center;
            gap:8px;
            border:none;
        }
        .btn-primary {
            background: linear-gradient(90deg,var(--accent1),var(--accent2));
            color:white;
            box-shadow: 0 8px 22px rgba(99,102,241,0.18);
        }
        .btn-secondary {
            background:transparent;
            border:1px solid rgba(15,23,42,0.06);
            color:inherit;
        }
        .btn:hover{ transform: translateY(-3px); }

        .receipt-preview{
            background: linear-gradient(180deg, rgba(99,102,241,0.04), rgba(139,92,246,0.02));
            padding:12px;
            border-radius:10px;
            border:1px dashed rgba(99,102,241,0.06);
            min-height:190px;
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace;
            font-size:13px;
            color: inherit;
            white-space: pre-wrap;
            overflow:auto;
        }

        .controls { display:flex; gap:8px; margin-top:12px; flex-wrap:wrap; }
        .small-muted { color:var(--muted); font-size:12px; margin-top:8px; }

        /* interactive plan chips */
        .plan-chips { display:flex; gap:8px; flex-wrap:wrap; margin-top:8px; }
        .chip {
            padding:6px 10px;
            border-radius:999px;
            background: rgba(15,23,42,0.04);
            cursor:pointer;
            font-size:13px;
            transition: all .14s;
            border:1px solid transparent;
        }
        .chip:hover{ transform:translateY(-3px); border-color: rgba(99,102,241,0.14); box-shadow: 0 6px 18px rgba(99,102,241,0.06); }
        .chip.active { background: linear-gradient(90deg,var(--accent1),var(--accent2)); color:white; }

        footer{ text-align:center; margin-top:16px; color:var(--muted); font-size:12px; }

        /* theme toggle */
        .theme-toggle {
            width:40px; height:40px; border-radius:10px; display:inline-flex; align-items:center; justify-content:center;
            border:1px solid rgba(15,23,42,0.06); background:transparent; cursor:pointer;
        }
        .theme-toggle:hover{ transform: rotate(8deg) scale(1.03); box-shadow: 0 10px 26px rgba(99,102,241,0.06); }

    </style>
</head>
<body>
    <div class="container">
        <div class="topbar">
            <div>
                <div class="title">Kunkun Moe — Receipt Generator</div>
                <div class="subtitle">Font sedikit kecil, tata rapi, interaktif — siap pakai</div>
            </div>
            <div class="flex">
                <button id="themeToggle" class="theme-toggle" title="Toggle theme">
                    <i class="fas fa-moon" id="themeIcon"></i>
                </button>
            </div>
        </div>

        <div class="grid">
            <!-- Form -->
            <div class="card">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
                    <div style="font-weight:700;font-size:15px;">Form Pembelian</div>
                    <div style="font-size:12px;color:var(--muted)">Interaktif • Responsive</div>
                </div>

                <form id="receiptForm" onsubmit="return false;">
                    <div class="form-group">
                        <label for="product">Pilih Produk</label>
                        <select id="product" required>
                            <option value="">-- Pilih produk --</option>
                            <option value="spotify">Spotify Premium</option>
                            <option value="disney">Disney+ Hotstar</option>
                            <option value="prime">Amazon Prime Video</option>
                            <option value="hbo">HBO / Max</option>
                            <option value="youtube">YouTube Premium</option>
                            <option value="steam">Steam Wallet</option>
                            <option value="voucher">Voucher Game / Top-up</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="plan">Pilih Plan</label>
                        <select id="plan" required>
                            <option value="">-- Pilih plan --</option>
                        </select>
                        <div class="plan-chips" id="planChips" aria-hidden="true"></div>
                        <div class="hint" id="planHint">Pilih produk terlebih dahulu untuk melihat opsi plan.</div>
                    </div>

                    <div class="field-row">
                        <div class="form-group">
                            <label for="price">Harga</label>
                            <input id="price" placeholder="Rp 25.000" />
                        </div>
                        <div class="form-group">
                            <label for="duration">Durasi</label>
                            <input id="duration" placeholder="Contoh: 1 Bulan / 30 Hari / Permanent" />
                        </div>
                    </div>

                    <div id="dynamicFields" class="dynamic-fields">
                        <div class="form-group">
                            <label for="buyer">Nama / Username Pembeli</label>
                            <input id="buyer" placeholder="Nama pembeli atau username" />
                        </div>
                        <div class="form-group">
                            <label for="note">Catatan (opsional)</label>
                            <input id="note" placeholder="Catatan singkat" />
                        </div>
                    </div>

                    <div class="controls" style="margin-top:10px;">
                        <button id="generate" class="btn btn-primary"><i class="fas fa-magic"></i> Generate</button>
                        <button id="clear" class="btn btn-secondary" type="button"><i class="fas fa-eraser"></i> Clear</button>
                    </div>
                </form>
            </div>

            <!-- Output -->
            <div class="card">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
                    <div style="font-weight:700;font-size:15px;">Preview Nota</div>
                    <div class="small-muted">Netflix sudah dihapus • ID dibuat otomatis</div>
                </div>

                <div id="output" class="receipt-preview" role="status" aria-live="polite">
Click "Generate" untuk membuat nota pembelian...
                </div>

                <div class="controls">
                    <button id="copyText" class="btn btn-primary"><i class="fas fa-copy"></i> Salin</button>
                    <button id="downloadTxt" class="btn btn-secondary"><i class="fas fa-download"></i> Unduh .txt</button>
                    <button id="printPreview" class="btn btn-secondary"><i class="fas fa-print"></i> Print</button>
                </div>
            </div>
        </div>

        <footer>© babayshop.id — Kunkun Moe Convert UI</footer>
    </div>

    <script>
        // Theme persistence & toggle
        const themeToggle = document.getElementById('themeToggle');
        const themeIcon = document.getElementById('themeIcon');
        function setTheme(theme){
            if(theme==='dark'){ document.documentElement.classList.add('dark-mode'); themeIcon.className='fas fa-sun'; localStorage.setItem('km_theme','dark'); }
            else { document.documentElement.classList.remove('dark-mode'); themeIcon.className='fas fa-moon'; localStorage.setItem('km_theme','light'); }
        }
        (function(){ setTheme(localStorage.getItem('km_theme')||'light'); })();
        themeToggle.addEventListener('click', ()=> {
            const isDark = document.documentElement.classList.contains('dark-mode');
            setTheme(isDark ? 'light' : 'dark');
        });

        // Elements
        const productEl = document.getElementById('product');
        const planEl = document.getElementById('plan');
        const priceEl = document.getElementById('price');
        const durationEl = document.getElementById('duration');
        const buyerEl = document.getElementById('buyer');
        const noteEl = document.getElementById('note');
        const outputEl = document.getElementById('output');
        const generateBtn = document.getElementById('generate');
        const clearBtn = document.getElementById('clear');
        const copyBtn = document.getElementById('copyText');
        const downloadBtn = document.getElementById('downloadTxt');
        const printBtn = document.getElementById('printPreview');
        const planHint = document.getElementById('planHint');
        const planChips = document.getElementById('planChips');

        // Product meta
        const PRODUCTS = {
            spotify:{ name:'Spotify Premium', plans:{ '1bulan':'1 Bulan','3bulan':'3 Bulan','6bulan':'6 Bulan','12bulan':'12 Bulan','lifetime':'Permanent' }, defaultPrice:'Rp 20.000' },
            disney:{ name:'Disney+ Hotstar', plans:{ '1bulan':'1 Bulan','3bulan':'3 Bulan','12bulan':'12 Bulan','lifetime':'Permanent' }, defaultPrice:'Rp 25.000' },
            prime:{ name:'Amazon Prime Video', plans:{ '1bulan':'1 Bulan','6bulan':'6 Bulan','12bulan':'12 Bulan' }, defaultPrice:'Rp 30.000' },
            hbo:{ name:'HBO / Max', plans:{ '1bulan':'1 Bulan','3bulan':'3 Bulan','12bulan':'12 Bulan' }, defaultPrice:'Rp 28.000' },
            youtube:{ name:'YouTube Premium', plans:{ '1bulan':'1 Bulan','12bulan':'12 Bulan' }, defaultPrice:'Rp 25.000' },
            steam:{ name:'Steam Wallet', plans:{ 'voucher':'Voucher / Top-up' }, defaultPrice:'Rp 10.000' },
            voucher:{ name:'Voucher Game / Top-up', plans:{ 'voucher':'Voucher / Top-up' }, defaultPrice:'Rp 10.000' }
        };

        function clearPlanChips(){ planChips.innerHTML=''; planChips.setAttribute('aria-hidden','true'); }

        function updatePlans(){
            const key = productEl.value;
            planEl.innerHTML = '<option value="">-- Pilih plan --</option>';
            clearPlanChips();
            if(!key){ planHint.textContent = 'Pilih produk terlebih dahulu untuk melihat opsi plan.'; return; }
            const meta = PRODUCTS[key];
            planHint.textContent = `Default harga: ${meta.defaultPrice}`;
            // populate select and chips
            for(const [k,v] of Object.entries(meta.plans)){
                const opt = document.createElement('option'); opt.value=k; opt.textContent=v; planEl.appendChild(opt);
                const chip = document.createElement('div'); chip.className='chip'; chip.textContent=v; chip.dataset.val=k;
                chip.addEventListener('click', ()=> {
                    // set active
                    document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
                    chip.classList.add('active');
                    planEl.value = chip.dataset.val;
                    if(!durationEl.value.trim()) durationEl.value = chip.textContent;
                });
                planChips.appendChild(chip);
            }
            planChips.setAttribute('aria-hidden','false');
            if(!priceEl.value.trim()) priceEl.value = meta.defaultPrice;
        }
        productEl.addEventListener('change', updatePlans);

        // simple id generator (no prefix)
        function nowSlug(){
            const d = new Date();
            return 'NOTA' + d.getFullYear().toString().slice(-2) + ('0'+(d.getMonth()+1)).slice(-2) + ('0'+d.getDate()).slice(-2) + ('0'+d.getHours()).slice(-2) + ('0'+d.getMinutes()).slice(-2) + ('0'+d.getSeconds()).slice(-2);
        }

        function formatNow(){
            const d = new Date();
            return d.toLocaleString('id-ID', { year:'numeric', month:'short', day:'numeric', hour:'2-digit', minute:'2-digit' });
        }

        function generateReceiptText(){
            const productKey = productEl.value;
            const productName = productKey ? (PRODUCTS[productKey]?.name || productKey) : '(tidak dipilih)';
            const planLabel = planEl.value ? (PRODUCTS[productKey]?.plans?.[planEl.value] || planEl.value) : '(tidak dipilih)';
            const price = priceEl.value.trim() || '(tidak diisi)';
            const duration = durationEl.value.trim() || planLabel || '(tidak diisi)';
            const buyer = buyerEl.value.trim() || '-';
            const note = noteEl.value.trim() || '-';
            const timestamp = formatNow();
            const receiptId = nowSlug();

            const lines = [];
            lines.push('╔════════════════════════════════╗');
            lines.push('        NOTA PEMBELIAN DIGITAL');
            lines.push('╚════════════════════════════════╝');
            lines.push('');
            lines.push(`ID Nota   : ${receiptId}`);
            lines.push(`Waktu     : ${timestamp}`);
            lines.push('');
            lines.push(`Produk    : ${productName}`);
            lines.push(`Plan      : ${planLabel}`);
            lines.push(`Durasi    : ${duration}`);
            lines.push(`Harga     : ${price}`);
            lines.push('');
            lines.push(`Pembeli   : ${buyer}`);
            lines.push(`Catatan   : ${note}`);
            lines.push('');
            lines.push('--------------------------------------------------');
            lines.push('Cara pembayaran: Transfer/Top-up sesuai instruksi penjual.');
            lines.push('Setelah pembayaran, kirim bukti untuk konfirmasi.');
            lines.push('Terima kasih telah berbelanja!');
            lines.push('');
            lines.push('by Kunkun Moe Convert');
            return lines.join('\n');
        }

        // Actions
        generateBtn.addEventListener('click', ()=>{
            if(!productEl.value){ alert('Pilih produk terlebih dahulu.'); productEl.focus(); return; }
            if(!planEl.value){ alert('Pilih plan terlebih dahulu.'); planEl.focus(); return; }
            outputEl.textContent = generateReceiptText();
        });

        clearBtn.addEventListener('click', ()=>{
            productEl.value=''; planEl.innerHTML='<option value="">-- Pilih plan --</option>'; priceEl.value=''; durationEl.value=''; buyerEl.value=''; noteEl.value=''; outputEl.textContent='Click "Generate" untuk membuat nota pembelian...';
            planHint.textContent = 'Pilih produk terlebih dahulu untuk melihat opsi plan.'; clearPlanChips();
        });

        copyBtn.addEventListener('click', ()=>{
            const text = outputEl.textContent || '';
            if(!text.trim()) return;
            if(navigator.clipboard && navigator.clipboard.writeText){
                navigator.clipboard.writeText(text).then(()=> {
                    const orig = copyBtn.innerHTML;
                    copyBtn.innerHTML = '<i class="fas fa-check"></i> Disalin';
                    setTimeout(()=> copyBtn.innerHTML = orig, 1200);
                }).catch(()=> fallbackCopy(text));
            } else fallbackCopy(text);
        });

        function fallbackCopy(txt){
            const ta = document.createElement('textarea'); ta.value = txt; document.body.appendChild(ta); ta.select();
            try{ document.execCommand('copy'); alert('Teks disalin (fallback)'); } catch(e){ alert('Gagal menyalin otomatis.'); }
            ta.remove();
        }

        downloadBtn.addEventListener('click', ()=>{
            const text = outputEl.textContent || '';
            if(!text.trim()){ alert('Belum ada nota untuk diunduh.'); return; }
            const blob = new Blob([text], { type:'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a'); a.href = url; a.download = 'nota-pembelian.txt'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
        });

        printBtn.addEventListener('click', ()=>{
            const content = outputEl.textContent || '';
            if(!content.trim()){ alert('Belum ada nota untuk dicetak.'); return; }
            const w = window.open('','_blank','width=700,height=800');
            const html = `<html><head><title>Print Nota</title><style>body{font-family:monospace;padding:20px;white-space:pre-wrap;} pre{font-size:13px;}</style></head><body><pre>${escapeHtml(content)}</pre><script>window.print();</script></body></html>`;
            w.document.write(html); w.document.close();
        });

        function escapeHtml(s){ return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

        // UX: when product selected, auto populate plans & chips; when plan select, mark chip active
        productEl.addEventListener('change', ()=> {
            updatePlans();
        });
        planEl.addEventListener('change', ()=> {
            // sync chip active
            document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
            const selector = document.querySelector(`.chip[data-val="${planEl.value}"]`);
            if(selector) selector.classList.add('active');
            if(!durationEl.value.trim() && planEl.value){
                durationEl.value = planEl.options[planEl.selectedIndex].text;
            }
        });

        // init
        (function init(){
            // no PIN overlay: direct access
            // keep product empty so user chooses
            clearPlanChips();
        })();

    </script>
</body>
</html>
